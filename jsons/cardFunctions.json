{
  "functions": {
    "EXHAUST_TO_LOOK_AT_X": {
      "args": ["$CARD", "$X"],
      "code": ["ACTION_LIST_TO_LOOK_AT_X", 
          ["AND", "$CARD.inPlay", ["NOT", "$CARD.exhausted"]], 
          ["LIST", "TOGGLE_EXHAUST", "$CARD"], 
          "$CARD",
          "{{$CARD.controller}}Deck",
          "$X"
      ]
    },
    "DISCARD_TO_LOOK_AT_X": {
      "args": ["$CARD", "$X"],
      "code": ["ACTION_LIST_TO_LOOK_AT_X", 
          ["IN_STRING", "$CARD.groupId", "Hand"], 
          "discardCard", 
          "$CARD",
          "{{$CARD.controller}}Deck",
          "$X"
      ]
    },
    "EXHAUST_TO_LOOK_AT_ENCOUNTER_X": {
      "args": ["$CARD", "$X"],
      "code": ["ACTION_LIST_TO_LOOK_AT_X", 
          ["AND", "$CARD.inPlay", ["NOT", "$CARD.exhausted"]], 
          ["LIST", "TOGGLE_EXHAUST", "$CARD"], 
          "$CARD",
          "sharedEncounterDeck",
          "$X"
      ]
    },
    "DISCARD_TO_LOOK_AT_ENCOUNTER_X": {
      "args": ["$CARD", "$X"],
      "code": ["ACTION_LIST_TO_LOOK_AT_X", 
          ["IN_STRING", "$CARD.groupId", "Hand"], 
          "discardCard", 
          "$CARD",
          "sharedEncounterDeck",
          "$X"
      ]
    },
    "ACTION_LIST_TO_LOOK_AT_X": {
      "args": ["$CONDITION", "$ACTION_LIST", "$CARD", "$GROUP_ID", "$X"],
      "code": ["COND",
          "$CONDITION",
          [   
              ["VAR", "$ACTIVE_CARD_ID", "$CARD.id"],
              ["ACTION_LIST", "$ACTION_LIST"],
              ["LOOK_AT_X", "$GROUP_ID", "$X"]
          ],
          ["TRUE"],
          ["LOG", "└── ", "The ability's conditions are not met."]
      ]
    },
    "LOOK_AT_X": {
      "args": ["$GROUP_ID", "$X"],
      "code": [
        ["VAR", "$GROUP", "$GAME.groupById.$GROUP_ID"],
        ["LOG", "└── {{$ALIAS_N}} is looking at the top {{$X}} cards of {{$GROUP.label}}."],
        ["LOOK_AT", "$PLAYER_N", "$GROUP_ID", "$X", true]
      ]
    },
    "HAS_5_OR_MORE_DWARVES": {
      "args": ["$PLAYER"],
      "code": [
        ["VAR", "$DWARF_COUNT", 0],
        ["VAR", "$DWARF_CARDS",
          ["FILTER_CARDS",
            "$CARD",
            ["AND",
              ["EQUAL", "$CARD.controller", "$PLAYER"],
              ["EQUAL", "$CARD.inPlay", true],
              ["IN_STRING", "$CARD.currentFace.traits", "Dwarf."],
              ["EQUAL", "$CARD.currentSide", "A"]
            ]
          ]
        ],
        ["FOR_EACH_VAL", "$DWARF_CARD", "$DWARF_CARDS", [
          "COND",
          ["AND",
            ["EQUAL", "$DWARF_CARD.currentFace.name", "Bombur"],
            ["EQUAL", "$DWARF_CARD.sides.A.type", "Hero"]
          ],
          ["INCREASE_VAR", "$DWARF_COUNT", 2],
          ["TRUE"],
          ["INCREASE_VAR", "$DWARF_COUNT", 1]
        ]],
        ["GREATER_EQUAL", "$DWARF_COUNT", 5]   
      ]
    },
    "ACTIVE_LOCATION_HAS_TRAIT": {
      "args": ["$TRAIT"],
      "code": [
        ["VAR", "$ACTIVE_LOCATIONS_WITH_TRAIT", ["FILTER_CARDS", "$C", [
          "AND",
              ["EQUAL", "$C.groupId", "sharedActiveLocation"],
              ["EQUAL", "$C.currentFace.type", "Location"],
              ["IN_STRING", "$C.currentFace.traits", "$TRAIT"]
        ]]],
        ["GREATER_THAN", ["LENGTH", "$ACTIVE_LOCATIONS_WITH_TRAIT"], 0]
      ]
    },
    "DOOMED": {
      "args": ["$X"],
      "code": [
        ["LOG", "└── ", "Raised each player's threat by $X."],
        ["FOR_EACH_VAL", "$PLAYER_I", "$PLAYER_ORDER", [
          ["INCREASE_VAL", "/playerData/$PLAYER_I/threat", "$X"]
        ]]
      ]
    },
    "IS_PLAYER_IN_VALOUR": {
      "args": ["$PLAYER"],
      "code": [
        "GREATER_EQUAL", "$GAME.playerData.{{$PLAYER}}.threat", 40
      ]
    },
    "HEAL": {
      "args": ["$CARD_ID", "$X"],
      "code": [
        ["COND",
          ["GREATER_THAN", "$GAME.cardById.$CARD_ID.tokens.damage", "$X"],
            ["DECREASE_VAL", "/cardById/$CARD_ID/tokens/damage", "$X"],
          true,
            ["SET", "/cardById/$CARD_ID/tokens/damage", 0]
        ]
      ]
    }
  }
}